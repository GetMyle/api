# Query

## Execute query

```javascript
const request = require('request');

const options = {
    method: 'POST',
    url: 'https://api.getmyle.com/v1/query',
    headers: {
        Authorization: getHawkHeader('https://api.getmyle.com/v1/query', 'POST', getUserTicket()).field
    },
    json: {
        sets: ['master'],
        take: 1
    }
};

request(options, (err, res, records) => {
    if (err) {
        return console.error(err);
    }
    console.log(records);
});
```

> The above request returns JSON structured like this:

```json
[
  {
    "id": "3300",
    "keyphrase": null,
    "time": "2016-11-09T07:23:41.000Z",
    "tzOffset": -420,
    "phrase": "Go to meeting tomorrow at 5 PM",
    "language": "eng-USA",
    "longitude": null,
    "latitude": null,
    "altitude": null,
    "isDeleted": false
  }
]
```

This endpoint executes a query to user mylet records.

### HTTP Request

`POST https://api.getmyle.com/v1/query`

### Headers

Header | Description
--------- | -----------
Authorization | The user ticket generated by [Hawk](#authorization-header)

### Request body

A [mylet query](#query-request).

### Response body

A [mylet query response](#query-response).

## Mylet query

> Example of a mylet query

```json
{
    "sets": ["master"],
    "where": {
        "time": {
            "$gte": "2016-11-11"
        }
    }
}
```

A mylet query is used to query user records associated with a mylet. A mylet query is represented in JSON format.

### Query request

Mylet query is a JSON with the folling properties:

Property | Required | Description
--------- | --------- | ---------
sets | true | A set to query from. Must be an array with a single `master` element in it
select | optional | An array of [fields](#query-response) to select. If not specified, `id`, `phrase` and `time` are selected
where | optional | An object to filter resultset by, see [Query `where` clause](#query-where-clause) below
orderBy | optional | An array of [fields](#query-response) to order by. To specify order direction explictly use `{ "$desc": "field" }` or `{ "$asc": "field" }` aray elements
skip | optional | Skips first number of records.
take | optional | Returns specified number of records. Defaults to `100` if not specified. Fallbacks to `100` if specified value is greater than `100`.

### Query `where` clause

To specify equality condition, use the criteria `{ <field>: <value> }` to select all records that contain the `<field>` with the specified `<value>`.

A criteria can use the property operators to specify a condition. For example, `{ a: { $ne: 1 } }` selects all records where property `a` not equal to `1`.

A compound criteria can specify conditions for more than one field in a record. Implicitly, a logical `AND` conjunction connects the clauses of a compound criteria so that the query selects the documents that match all the conditions. For example, `{ a: 1, b: 2 }` selects all documents where `a` equals to `1` __and__ `b` equals to `2`.

Using the `$and`, `$or` and `$not` group operator, you can explicitly specify a compound criteria. For example, `{ $or: [{ a: 1 }, { a: 2 }] }` selects all documents where property `a` equals to `1` or `2`.

Supported group operators:

Operator|Meaning|Examples
---|---|---
`$and`|AND|`{ latitude: 4, longitude: 6 }` is equal to `{ $and: { latitude: 4, longitude: 6 } }` and is equal to `{ $and: [ { latitude: 4 }, { longitude: 6 } ] }` and means latitude equals 4 and longitude equals 6
`$or`|OR|`{ $or: { latitude: 4, longitude: 6 } }` is equal to `{ $or: [ { latitude: 4 }, { longitude: 6 } ] }` and means latitude equal 4 or longitude equals 6
`$not`|negation|`{ $not: { latitude: 4 } }` means latitude not equal to 4; `{ latitude: 4, { $not: { longitude: 6 } } }` means latitude equals 4 and longitude not equals to 6

Supported property operators:

Operator|Meaning|Examples
---|---|---
`$e`|equals|`{ latitude: { $e: 4 } }` means latitude equals 4 and is the same as `{ latitude: 4 }`
`$ne`|not equal to|`{ latitude: { $ne: 4 } }` means latitude not equal to 4
`$gte`|greater than or equal to|`{ latitude: { $gte: 4 } }` means latitude is greater than or equal to 4
`$gt`|greater than|`{ latitude: { $gte: 4 } }` means latitude is greater than 4
`$lte`|less than or equal to|`{ latitude: { $lte: 4 } }` means latitude is less than or equal to 4
`$lt`|less than|`{ latitude: { $lt: 4 } }` means latitude is less than 4
`$contains`|string contains|`{ phrase: { $contains: "test" } }` means phrase contains "test" string. Applicable only to `phrase` field
`$startsWith`|string starts with|`{ phrase: { $startsWith: "a" } }` means phrase starts with "a" string. Applicable only to `phrase` field
`$endsWith`|string ends with|`{ phrase: { $endsWith: "a" } }` means phrase ends with "a" string. Applicable only to `phrase` field
`$in`|is in array|`{ altitude: { $in: [1, 2, 3, 4] } }` means altitude has value 1, 2, 3 or 4


### Query response

Result of a mylet query is an array of objects with the following properties:

Property | Description
--------- | ---------
id | Record identifier
phrase | Record text
time | UTC time when a record was added
keyphrase | A keyphrase used for record association
tzOffset | User's timezone offset on records creation time
language | Language code used for recognition, for example, `eng-USA`
longitude | Longitude
latitude | Latitude
altitude | Altitude
isDeleted | Flag indicating whether association with a mylet was deleted or not